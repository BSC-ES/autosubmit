[archdef]
MODELS_DIR = /gpfs/projects/ecm86/models
SCRATCH_DIR = /gpfs/scratch
SCRATCH_TMP_DIR = $TMPDIR
HSM_DIR = /gpfs/scratch/ecm86/ecm86010

GRIBAPIPATH = /gpfs/projects/ecm86/opt/grib_api-1.9.9/intel-13/bin
GRIBAPIPATH_DEF = /gpfs/projects/ecm86/opt/grib_api-1.9.9/intel-13/share/definitions
GRIBAPIPATH_SAM = /gpfs/projects/ecm86/opt/grib_api-1.9.9/intel-13/ifs_samples/grib1

ENVCOM=
# modules setup
 set +xuve
 source /usr/share/modules/init/ksh
 module purge
 module load intel
 module list
 PATH=/gpfs/projects/ecm86/opt/netcdf-3.6.3/intel-13/bin:${PATH}
 PATH=/gpfs/projects/ecm86/opt/nco-3.9.9/intel-13/bin:${PATH}
 PATH=/gpfs/projects/ecm86/opt/cdo-1.4.5.1/intel-13/bin:${PATH}
 PATH=/gpfs/projects/ecm86/opt/rebuild-r1312/bin:${PATH}
 PATH=/gpfs/projects/ecm86/opt/grib_api-1.8.0/intel-13/bin:${PATH}
 set -xuve

ENVPARA=
# modules setup
 set +xuve
 source /usr/share/modules/init/ksh
 module purge
 module load intel
 module load impi
 export I_MPI_PMI_EXTENSIONS=on
 export DAPL_DBG_TYPE_CM_EST="0x8000"
 export DAPL_DBG_TYPE_CM_WARN="0x10000"
 export DAPL_CM_ROUTE_TIMEOUT_MS=20000
 export DAPL_CM_ARP_TIMEOUT_MS=10000
 export DAPL_UCM_REP_TIME=800
 export DAPL_UCM_RTU_TIME=400
 export DAPL_UCM_RETRY=30
 export DAPL_ACK_RETRY=30
 export DAPL_ACK_TIME=30
 export I_MPI_DEVICE="rdssm:none"
 export I_MPI_MPD_RSH=ssh
 export I_MPI_FALLBACK_DEVICE=1
 module list
 set -xuve

RUNPARAIFS=
# set +e to avoid random errors at the end of each chunk
 set +e
 ulimit -s unlimited
 mpirun -np $IFS_nproc ${IFS_exe} -v ecmwf -e $EXPVER
 set -e

RUNPARANEM=
# set +e to avoid random errors at the end of each chunk
 set +e
 ulimit -s unlimited
 mpirun -np $NEMO_nproc ${NEMO_exe}
 set -e

RUNPARAECE=
# set +e to avoid random errors at the end of each chunk
 set +e
 ulimit -s unlimited
 mpirun -np $OASIS_nproc ${OASIS3_exe} : \
        -np $IFS_nproc ${IFS_exe} -v ecmwf -e $EXPVER : \
        -np $NEMO_nproc ${NEMO_exe}
 set -e

ENVCOM3=
# modules setup
 set +xuve
 module purge
 module load intel szip hdf5 netcdf
 module list
 PATH=/gpfs/apps/MN3/NETCDF/4.1.3/bin:${PATH}
 PATH=/gpfs/apps/MN3/NCO/4.2.3/bin:${PATH}
 PATH=/gpfs/apps/MN3/CDO/1.5.9/bin:${PATH}
 PATH=/gpfs/projects/ecm86/opt/rebuild_nemo-ece3/intel-13/bin:${PATH}
 PATH=/gpfs/projects/ecm86/opt/grib_api-1.9.9/intel-13/bin:${PATH}
 set -xuve

CDFTOOLS2=
 PATH=/gpfs/projects/ecm86/opt/cdftools-2.1/intel-13/bin:${PATH}

CDFTOOLS3=
 PATH=/gpfs/projects/ecm86/opt/cdftools-3.0/intel-13/bin:${PATH}

ENVPARA3=
# modules setup
 set +xuve
 module purge
 module load intel
 case $VERSION in
  v3.0)
   module load openmpi
   export OMPI_MCA_mpool_rdma_rcache_size_limit=1000000000
   export OMPI_MCA_btl_openib_receive_queues="S,4096,1024:S,12288,512:S,65536,512"
   export OMPI_MCA_btl_openib_ib_min_rnr_timer=25
   export OMPI_MCA_btl_openib_ib_timeout=20
  ;;
  *) 
   module load impi
   export I_MPI_PMI_EXTENSIONS=on
   export DAPL_DBG_TYPE_CM_EST="0x8000"
   export DAPL_DBG_TYPE_CM_WARN="0x10000"
   export DAPL_CM_ROUTE_TIMEOUT_MS=20000
   export DAPL_CM_ARP_TIMEOUT_MS=10000
   export DAPL_UCM_REP_TIME=800
   export DAPL_UCM_RTU_TIME=400
   export DAPL_UCM_RETRY=30
   export DAPL_ACK_RETRY=30
   export DAPL_ACK_TIME=30
   export I_MPI_DEVICE="rdssm:none"
   export I_MPI_MPD_RSH=ssh
   export I_MPI_FALLBACK_DEVICE=1
  ;;
 esac
 module load mkl
 module load szip
 module load hdf5
 module load netcdf
 module list
 set -xuve

RUNPARAIFS3=
# set +e to avoid random errors at the end of each chunk
 set +e
 ulimit -s unlimited
 mpirun -np $ifs_numproc ${ifs_exe_file} -v ecmwf -e $exp_name
 set -e

RUNPARANEM3=
# set +e to avoid random errors at the end of each chunk
 set +e
 ulimit -s unlimited
 mpirun -np $nem_numproc ${nem_exe_file}
 set -e

RUNPARAECE3=
# set +e to avoid random errors at the end of each chunk
 set +e
 ulimit -s unlimited
 mpirun -np ${oas_numproc} ${oas_exe_file} : \
        -np ${ifs_numproc} ${ifs_exe_file} -v ecmwf -e ${exp_name} : \
        -np ${nem_numproc} ${nem_exe_file}
 set -e

HEADER_LOCALSETUP= #!/bin/bash
 ###############################################################################
 #                   %%TASKTYPE%% %%TEMPLATE_NAME%% EXPERIMENT
 ###############################################################################

HEADER_REMOTESETUP= #!/bin/sh
 ###############################################################################
 #                   %%TASKTYPE%% %%TEMPLATE_NAME%% EXPERIMENT
 ###############################################################################
 #
 #BSUB -J %%JOBNAME%%
 #BSUB -oo %%SCRATCH_DIR%%/%%HPCPROJ%%/%%HPCUSER%%/%%EXPID%%/LOG_%%EXPID%%/%%JOBNAME%%_%%J.out 
 #BSUB -eo %%SCRATCH_DIR%%/%%HPCPROJ%%/%%HPCUSER%%/%%EXPID%%/LOG_%%EXPID%%/%%JOBNAME%%_%%J.err
 #BSUB -W %%WALLCLOCK%%
 #BSUB -n %%NUMPROC%%
 #BSUB -R "span[ptile=16]"
 #
 ###############################################################################

HEADER_INI= #!/bin/sh
 ###############################################################################
 #                   %%TASKTYPE%% %%TEMPLATE_NAME%% EXPERIMENT
 ###############################################################################
 #
 #BSUB -J %%JOBNAME%%
 #BSUB -oo %%SCRATCH_DIR%%/%%HPCPROJ%%/%%HPCUSER%%/%%EXPID%%/LOG_%%EXPID%%/%%JOBNAME%%_%%J.out 
 #BSUB -eo %%SCRATCH_DIR%%/%%HPCPROJ%%/%%HPCUSER%%/%%EXPID%%/LOG_%%EXPID%%/%%JOBNAME%%_%%J.err
 #BSUB -W %%WALLCLOCK%%
 #BSUB -n %%NUMPROC%%
 #BSUB -R "span[ptile=16]"
 #
 ###############################################################################

HEADER_SIM= #!/bin/sh
 ###############################################################################
 #                   %%TASKTYPE%% %%TEMPLATE_NAME%% EXPERIMENT
 ###############################################################################
 #
 #BSUB -J %%JOBNAME%%
 #BSUB -oo %%SCRATCH_DIR%%/%%HPCPROJ%%/%%HPCUSER%%/%%EXPID%%/LOG_%%EXPID%%/%%JOBNAME%%_%%J.out 
 #BSUB -eo %%SCRATCH_DIR%%/%%HPCPROJ%%/%%HPCUSER%%/%%EXPID%%/LOG_%%EXPID%%/%%JOBNAME%%_%%J.err
 #BSUB -W %%WALLCLOCK%%
 #BSUB -n %%NUMPROC%%
 #BSUB -R "span[ptile=16]"
 #
 ###############################################################################

HEADER_POST= #!/bin/sh
 ###############################################################################
 #                   %%TASKTYPE%% %%TEMPLATE_NAME%% EXPERIMENT
 ###############################################################################
 #
 #BSUB -J %%JOBNAME%%
 #BSUB -oo %%SCRATCH_DIR%%/%%HPCPROJ%%/%%HPCUSER%%/%%EXPID%%/LOG_%%EXPID%%/%%JOBNAME%%_%%J.out 
 #BSUB -eo %%SCRATCH_DIR%%/%%HPCPROJ%%/%%HPCUSER%%/%%EXPID%%/LOG_%%EXPID%%/%%JOBNAME%%_%%J.err
 #BSUB -W %%WALLCLOCK%%
 #BSUB -n %%NUMPROC%%
 #BSUB -R "span[ptile=16]"
 #BSUB -x
 #
 ###############################################################################

HEADER_CLEAN= #!/bin/sh
 ###############################################################################
 #                   %%TASKTYPE%% %%TEMPLATE_NAME%% EXPERIMENT
 ###############################################################################
 #
 #BSUB -J %%JOBNAME%%
 #BSUB -oo %%SCRATCH_DIR%%/%%HPCPROJ%%/%%HPCUSER%%/%%EXPID%%/LOG_%%EXPID%%/%%JOBNAME%%_%%J.out 
 #BSUB -eo %%SCRATCH_DIR%%/%%HPCPROJ%%/%%HPCUSER%%/%%EXPID%%/LOG_%%EXPID%%/%%JOBNAME%%_%%J.err
 #BSUB -W %%WALLCLOCK%%
 #BSUB -n %%NUMPROC%%
 #BSUB -R "span[ptile=16]"
 #
 ###############################################################################

HEADER_LOCALTRANS= #!/bin/bash
 ###############################################################################
 #                   %%TASKTYPE%% %%TEMPLATE_NAME%% EXPERIMENT
 ###############################################################################

HEADER_WRP = #!/bin/sh
 ###############################################################################
 #                              %%TASKTYPE%%
 ###############################################################################
 #
 #BSUB -J %%JOBNAME%%
 #BSUB -oo %%SCRATCH_DIR%%/%%HPCPROJ%%/%%HPCUSER%%/%%EXPID%%/LOG_%%EXPID%%/%%JOBNAME%%_%%J.out 
 #BSUB -eo %%SCRATCH_DIR%%/%%HPCPROJ%%/%%HPCUSER%%/%%EXPID%%/LOG_%%EXPID%%/%%JOBNAME%%_%%J.err
 #BSUB -W %%WALLCLOCK%%
 #BSUB -n %%NUMPROC%%
 #BSUB -R "span[ptile=16]"
 #
 ###############################################################################

