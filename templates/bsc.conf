[archdef]
SHELL = /bin/ksh
ECEARTH_DIR = /gpfs/projects/ecm86/models/ecearth
SCRATCH_DIR = /gpfs/scratch/ecm86
INITIALDIR = %(SCRATCH_DIR)s
HSMdir = /HSM/ecm86
DBdir = /gpfs/projects/ecm86/common/db/logs
PATHGRIBAPI = /gpfs/apps/GRIB/1.8.0/bin
REBUILD = /gpfs/projects/ecm86/models/ecearth/${VERSION}/sources/nemo/modipsl/modeles/IOIPSL/tools/rebuild
NCPATH = /gpfs/apps/NCO/4.0.1/bin
CDOPATH = /gpfs/apps/CDO/1.1.1/64/bin
SCRATCH_OUTPUT_ROOT_DIR = ${TMPDIR}

ENVIRONMENT = 

PARALLEL_RUN_IFS=
	#
	# Model Run
	#
	# set +e is required because there are random errors at the end
	# of each chunk
	#
	 set +e
	 ulimit -c 1000000
	 srun -n $IFS_nproc -l ${IFS_exe} -v ecmwf -e ${EXPVER}
	 set -e
	 echo "finished chunk"
	 date
	fi

PARALLEL_RUN_ECEARTH=
	#
	# Model Run
	#
	 echo "0-$((OASIS_nproc-1)) ${OASIS3_exe}" > model.conf
	 echo "$OASIS_nproc-$((IFS_nproc+$((OASIS_nproc-1)))) ${IFS_exe} -v ecmwf -e $EXPVER" >> model.conf
	 echo "$((OASIS_nproc+IFS_nproc))-$((SLURM_NPROCS-1)) ${NEMO_exe}" >> model.conf
	 date
	#
	# set +e is required because there are random errors at the end
	# of each chunk
	#
	 set +e
         ulimit -c 1000000
	 srun -n $SLURM_NPROCS -l --multi-prog model.conf
	 set -e
	 echo "finished chunk"
	 date
	fi

PARALLEL_RUN_NEMO=
	ulimit -s unlimited
	if [ ${VERSION} == v3.2 ] ; then
	  exec=opa
	else
	  exec=nemo.exe
	fi
	cp $NEMODIR/bin/${exec}  opa.xx
	chmod 770 opa.xx

	time srun -n $NEMO_nproc -l opa.xx 

	echo "finished chunk"
	date
